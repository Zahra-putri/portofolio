{% extends 'layout.html' %}

{% block head %}
<title>Dashboard Admin</title>
{% endblock %}

{% block body %}
<link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">

<h2 class="text-center mb-4 text-pink fw-bold">Dashboard Admin</h2>

<!-- ALERT MESSAGE -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}

<!-- ==================== PROFIL ==================== -->
<section class="mb-5">
  <h4 class="fw-bold text-pink mb-3">Profil Admin</h4>
  <form action="{{ url_for('edit_profile') }}" method="POST" enctype="multipart/form-data" class="row g-3">
    <div class="col-md-3 text-center">
      <img src="{{ url_for('static', filename='uploads/' ~ profile[5]) }}"
           class="rounded-circle mb-3 shadow"
           width="150" height="150" alt="Foto Profil">
      <input type="file" class="form-control" name="photo">
    </div>
    <div class="col-md-9">
      <div class="mb-3">
        <label>Nama</label>
        <input type="text" class="form-control" name="name" value="{{ profile[3] }}" required>
      </div>
      <div class="mb-3">
        <label>Bio</label>
        <textarea class="form-control" name="bio" rows="3" required>{{ profile[4] }}</textarea>
      </div>
      <button type="submit" class="btn btn-pink">Simpan Perubahan</button>
    </div>
  </form>
</section>

<hr>

<!-- ==================== SKILLS ==================== -->
<section class="mb-5">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="fw-bold text-pink mb-0">Kelola Skills</h4>
    <button class="btn btn-pink btn-sm" data-bs-toggle="collapse" data-bs-target="#addSkillForm">+ Tambah Skill</button>
  </div>

  <div id="addSkillForm" class="collapse mb-3">
    <form action="{{ url_for('add_skill') }}" method="POST" class="row g-2">
      <div class="col-md-5">
        <input type="text" class="form-control" name="name" placeholder="Nama skill" required>
      </div>
      <div class="col-md-5">
        <input type="text" class="form-control" name="level" placeholder="Level (Beginner / Expert)" required>
      </div>
      <div class="col-md-2 d-grid">
        <button type="submit" class="btn btn-pink">Tambah</button>
      </div>
    </form>
  </div>

  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>Nama Skill</th>
        <th>Level</th>
        <th width="150">Aksi</th>
      </tr>
    </thead>
    <tbody>
      {% for s in skills %}
      <tr>
        <form action="{{ url_for('edit_skill', id=s[0]) }}" method="POST">
          <td><input type="text" class="form-control" name="name" value="{{ s[1] }}"></td>
          <td><input type="text" class="form-control" name="level" value="{{ s[2] }}"></td>
          <td>
            <button type="submit" class="btn btn-sm btn-outline-primary">Simpan</button>
            <a href="{{ url_for('delete_skill', id=s[0]) }}" class="btn btn-sm btn-danger"
               onclick="return confirm('Hapus skill ini?')">Hapus</a>
          </td>
        </form>
      </tr>
      {% endfor %}
      {% if not skills %}
      <tr><td colspan="3" class="text-center text-muted">Belum ada skill.</td></tr>
      {% endif %}
    </tbody>
  </table>
</section>

<hr>

<!-- ==================== PROJECTS ==================== -->
<section>
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="fw-bold text-pink mb-0">Kelola Projects</h4>
    <button class="btn btn-pink btn-sm" data-bs-toggle="collapse" data-bs-target="#addProjectForm">+ Tambah Project</button>
  </div>

  <div id="addProjectForm" class="collapse mb-3">
    <form action="{{ url_for('add_project') }}" method="POST" enctype="multipart/form-data" class="row g-2">
      <div class="col-md-3">
        <input type="text" class="form-control" name="title" placeholder="Judul project" required>
      </div>
      <div class="col-md-4">
        <input type="text" class="form-control" name="description" placeholder="Deskripsi" required>
      </div>
      <div class="col-md-3">
        <input type="text" class="form-control" name="link" placeholder="Link project (opsional)">
      </div>
      <div class="col-md-2">
        <input type="file" class="form-control" name="image">
      </div>
      <div class="col-md-12 text-end mt-2">
        <button type="submit" class="btn btn-pink">Tambah Project</button>
      </div>
    </form>
  </div>

  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>Judul</th>
        <th>Deskripsi</th>
        <th>Gambar</th>
        <th>Link</th>
        <th width="150">Aksi</th>
      </tr>
    </thead>
    <tbody>
      {% for p in projects %}
      <tr>
        <form action="{{ url_for('edit_project', id=p[0]) }}" method="POST" enctype="multipart/form-data">
          <td><input type="text" class="form-control" name="title" value="{{ p[1] }}"></td>
          <td><input type="text" class="form-control" name="description" value="{{ p[2] }}"></td>
          <td>
            {% if p[3] %}
              <img src="{{ url_for('static', filename='uploads/' ~ p[3]) }}" width="60" class="rounded shadow-sm mb-1">
            {% endif %}
            <input type="file" class="form-control form-control-sm" name="image">
          </td>
          <td><input type="text" class="form-control" name="link" value="{{ p[4] }}"></td>
          <td>
            <button type="submit" class="btn btn-sm btn-outline-primary">Simpan</button>
            <a href="{{ url_for('delete_project', id=p[0]) }}" class="btn btn-sm btn-danger"
               onclick="return confirm('Hapus project ini?')">Hapus</a>
          </td>
        </form>
      </tr>
      {% endfor %}
      {% if not projects %}
      <tr><td colspan="5" class="text-center text-muted">Belum ada project.</td></tr>
      {% endif %}
    </tbody>
  </table>
</section>

{% endblock %}
